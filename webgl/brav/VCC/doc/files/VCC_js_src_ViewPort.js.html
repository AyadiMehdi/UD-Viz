<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>VCC/js/src/ViewPort.js - Virtual City Client</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="Virtual City Client"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/FirstPersonControls.html">FirstPersonControls</a></li>
            
                <li><a href="../classes/VCC.Enum.html">VCC.Enum</a></li>
            
                <li><a href="../classes/VCC.Scheduler.html">VCC.Scheduler</a></li>
            
                <li><a href="../classes/VCC.SchedulerTask.html">VCC.SchedulerTask</a></li>
            
                <li><a href="../classes/VCC.TexturesManager.html">VCC.TexturesManager</a></li>
            
                <li><a href="../classes/VCC.Tile.html">VCC.Tile</a></li>
            
                <li><a href="../classes/VCC.TileManager.html">VCC.TileManager</a></li>
            
                <li><a href="../classes/VCC.ViewPort.html">VCC.ViewPort</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: VCC/js/src/ViewPort.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">

/**
* Main class, it will load and prepare the application and the scene
* @class ViewPort
* @author Alexandre Vienne
* @constructor
*/

VCC.ViewPort = function(){
	
	VCC.ViewPort = this;

	/** Offset to ho have low vertices position (easy computing for graphic cards) */
	this.offsetPosition = {x: 0, z: 0};
	
	/**
	* Server base URL 
	* @property serverUrl 
	* @type String
	*/
	this.serverUrl  = document.location.href.substring(0, document.location.href.lastIndexOf(&quot;/test&quot;) );

	/**
	* Root node
	* @property root 
	* @type THREE.Object3D
	*/
     this.root = new THREE.Object3D();

	/**Setting Scene*/

	/**
	* Scene of the application
	* @property scene 
	* @type THREE.Scene
	*/
	this.scene = new THREE.Scene();

	this.scene.add(this.root);

	/**
	* WebGl renderer, will draw the scene in the canvas
	* @property renderer 
	* @type THREE.WebGLRenderer
	*/
	this.renderer = new THREE.WebGLRenderer();

	this.renderer.setSize(window.innerWidth, window.innerHeight);
	this.renderer.setClearColor( 0x6699cc, 1 );

	document.body.appendChild(this.renderer.domElement);
	
	/**
	* Camera
	* @property camera 
	* @type THREE.PerspectiveCamera
	*/
	this.camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000000);
	
	/**
	* Will handle camera displacement
	* @property control 
	* @type THREE.FirstPersonControls
	*/
	this.control = new THREE.FirstPersonControls(this.camera, this.renderer.domElement);
	
    /**
	* Directionnal light of the scene
	* @property dirLight 
	* @type THREE.DirectionalLight
	*/
    this.dirLight = new THREE.DirectionalLight( 0xffffff );

    this.eventHandler = new VCC.EventHandler();
    
    this.dirLight.position = new THREE.Vector3(/*10000,10000,-1000*/2373,56,2000).normalize();
    this.dirLight.intensity = 0.5;
    this.scene.add( this.dirLight );
    this.scene.add( new THREE.AmbientLight( 0xaaaaaa ));
    this.scene.fog = new THREE.FogExp2(0xffffff, 0.001);

     	
 	/** End Light */
	var config= {rangeCameraTuile : 1, mainTuileRow : 1296, mainTuileCol : 13724, sizeTuile : 500, boundingBoxSceneMin : [648000.000000,6862000.000000,0], boundingBoxSceneMax : [648500.000000,6862500.000000,353.54]}
	var rangeCameraTuile = config.rangeCameraTuile;
	var sizeTuile = config.sizeTuile;
	var mainTuileRow = config.mainTuileRow;
	var mainTuileCol = config.mainTuileCol;
	var boundingBoxSceneMin =config.boundingBoxSceneMin;
	this.tileManager = new VCC.TileManager(this.root,sizeTuile,rangeCameraTuile,mainTuileRow,mainTuileCol,config.boundingBoxSceneMin,config.boundingBoxSceneMax);
	this.tileManager.tilePriorityManager();
	/** Place camera in main Tile*/

	 this.camera.position.x = (config.boundingBoxSceneMin[0]+config.boundingBoxSceneMax[0])/2-config.boundingBoxSceneMin[0] - 70;
	 this.camera.position.y = (config.boundingBoxSceneMin[2]+config.boundingBoxSceneMax[2])/2-config.boundingBoxSceneMin[2];
	 this.camera.position.z = (config.boundingBoxSceneMin[1]+config.boundingBoxSceneMax[1])/2-config.boundingBoxSceneMin[1] - 70;


	/** End Tiles management*/

	/**
	* Stat object to have the FPS graph 
	* @property stats
	* @type Stats
	*/
	this.stats = new Stats();
	
	this.stats.setMode(0); // 0: fps, 1: ms	
	/**-----------------*/
	// Align top-left
	this.stats.domElement.style.position = &#x27;absolute&#x27;;
	this.stats.domElement.style.left = &#x27;0px&#x27;;
	this.stats.domElement.style.top = &#x27;0px&#x27;;
	document.body.appendChild( this.stats.domElement );
	
	this.stats.begin();
	
	/*Start app loop**/
	animate();
}

	/**
	* Render the scene 
	* @method
	* 
	*/
VCC.ViewPort.prototype.render = function() {
		this.stats.update();
		this.renderer.render(this.scene, this.camera);	
}



/*********************************************************
 * Animation loop function, update the tile management, process the camera displacement and call the render function.
 * Also log informations on the overlay
 * @method animate
 * @TODO handle lighting
 *********************************************************/
 function animate ()
 {
    requestAnimationFrame(animate);
   	VCC.ViewPort.tileManager.updateMainTile();
    VCC.ViewPort.render();
    VCC.ViewPort.control.update(0.1);
    VCC.ViewPort.dirLight.lookAt(VCC.ViewPort.camera.position);
    VCC.ViewPort.tileManager.scheduler.update();
    log(1,&quot;Memory :&quot; );
    log(2, &quot;Program : &quot; + VCC.ViewPort.renderer.info.memory.programs + &quot; geometry : &quot; + VCC.ViewPort.renderer.info.memory.geometries + &quot; Texture : &quot; + VCC.ViewPort.renderer.info.memory.textures);
    log(3,&quot;Render :&quot; );
    log(4,&quot;Calls : &quot; + VCC.ViewPort.renderer.info.render.calls + &quot; Vertices : &quot; + VCC.ViewPort.renderer.info.render.vertices + &quot; Points : &quot; + VCC.ViewPort.renderer.info.render.points);
    log(5, &quot;camera position : &quot; + VCC.ViewPort.camera.position.x + &quot; &quot; + VCC.ViewPort.camera.position.y + &quot; &quot; + VCC.ViewPort.camera.position.z);
    log(6,&quot;Main tile x : &quot; +VCC.ViewPort.tileManager.mainTileX+&quot; Main Tile y : &quot; + VCC.ViewPort.tileManager.mainTileY);
    log(7,&quot;LOD : &quot; + VCC.ViewPort.tileManager.sceneLod);
}

/**********************************************************
 * Show log text in the bottom left corner. There is max 10 line of log.
 * @method log
 *
 **********************************************************/
function log (id,text){
   document.getElementById(&quot;info&quot;+id).innerHTML = text;
}

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
